<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard | HealthCare Hospital</title>
    <link rel="stylesheet" href="../styles.css" />
    <link rel="stylesheet" href="dashboard.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <style>
      /* All dashboard styles moved to dashboard.css */
    </style>
  </head>
  <body>
    <div class="dashboard-container">
      <aside class="sidebar">
        <div class="sidebar-header">
          <img src="../IMAGES/logo-removebg-preview.png" alt="Logo" />
          Admin Panel
        </div>
        <nav class="sidebar-menu">
          <ul>
            <li>
              <a href="#" class="active"
                ><i class="fa fa-tachometer-alt"></i> Dashboard</a
              >
            </li>
            <li>
              <a href="#"><i class="fa fa-user-md"></i> Doctors</a>
            </li>
            <li>
              <a href="#"><i class="fa fa-users"></i> Patients</a>
            </li>
            <li>
              <a href="#"><i class="fa fa-calendar-check"></i> Appointments</a>
            </li>
            <li>
              <a href="#"><i class="fa fa-briefcase-medical"></i> Services</a>
            </li>
            <li>
              <a href="#"><i class="fa fa-flask-vial"></i> Lab Reports</a>
            </li>
            <li>
              <a href="#"><i class="fa fa-envelope"></i> Messages</a>
            </li>
            <li>
              <a href="#"><i class="fa fa-cogs"></i> Settings</a>
            </li>
          </ul>
        </nav>
        <div class="sidebar-footer">
          <i class="fa fa-user-shield"></i> Admin |
          <span id="current-date"></span>
        </div>
      </aside>
      <main class="main-content">
        <div class="dashboard-header">
          <h1>Welcome, Admin</h1>
          <div class="admin-info">
            <i class="fa fa-user-circle"></i> admin@lekeakaakematu.com
          </div>
        </div>
        <!-- Dashboard Section -->
        <section id="dashboard-section" class="dashboard-section-content">
          <div class="dashboard-stats">
            <div class="stat-card">
              <span class="stat-icon"><i class="fa fa-user-md"></i></span>
              <span class="stat-label">Doctors</span>
              <span class="stat-value">18</span>
            </div>
            <div class="stat-card">
              <span class="stat-icon"><i class="fa fa-users"></i></span>
              <span class="stat-label">Patients</span>
              <span class="stat-value">245</span>
            </div>
            <div class="stat-card">
              <span class="stat-icon"
                ><i class="fa fa-calendar-check"></i
              ></span>
              <span class="stat-label">Appointments</span>
              <span class="stat-value">32</span>
            </div>
            <div class="stat-card">
              <span class="stat-icon"
                ><i class="fa fa-briefcase-medical"></i
              ></span>
              <span class="stat-label">Services</span>
              <span class="stat-value">12</span>
            </div>
          </div>
          <div class="dashboard-section">
            <h2>Recent Appointments</h2>
            <table class="recent-table">
              <thead>
                <tr>
                  <th>Patient</th>
                  <th>Doctor</th>
                  <th>Date</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>John Doe</td>
                  <td>Dr. Smith</td>
                  <td>2025-05-25</td>
                  <td><span class="status completed">Completed</span></td>
                </tr>
                <tr>
                  <td>Jane Smith</td>
                  <td>Dr. Adams</td>
                  <td>2025-05-26</td>
                  <td><span class="status pending">Pending</span></td>
                </tr>
                <tr>
                  <td>Michael Lee</td>
                  <td>Dr. Brown</td>
                  <td>2025-05-26</td>
                  <td><span class="status cancelled">Cancelled</span></td>
                </tr>
                <tr>
                  <td>Sarah Kim</td>
                  <td>Dr. Patel</td>
                  <td>2025-05-27</td>
                  <td><span class="status pending">Pending</span></td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="dashboard-section">
            <h2>Recent Messages</h2>
            <table class="recent-table">
              <thead>
                <tr>
                  <th>From</th>
                  <th>Email</th>
                  <th>Subject</th>
                  <th>Date</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Mary Johnson</td>
                  <td>maryj@email.com</td>
                  <td>Appointment Inquiry</td>
                  <td>2025-05-25</td>
                </tr>
                <tr>
                  <td>Paul Green</td>
                  <td>paulg@email.com</td>
                  <td>Lab Report</td>
                  <td>2025-05-25</td>
                </tr>
                <tr>
                  <td>Linda White</td>
                  <td>lindaw@email.com</td>
                  <td>Feedback</td>
                  <td>2025-05-24</td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>
        <!-- Doctors Section -->
        <section
          id="doctors-section"
          class="dashboard-section-content"
          style="display: none"
        >
          <h2>Doctors Management</h2>
          <button class="add-btn" id="add-doctor-btn">
            <i class="fa fa-plus"></i> Add Doctor
          </button>
          <table class="recent-table" id="doctors-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Specialty</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="doctors-tbody">
              <tr>
                <td>Dr. Smith</td>
                <td>Cardiology</td>
                <td>smith@email.com</td>
                <td>+123456789</td>
                <td>
                  <button class="edit-btn"><i class="fa fa-edit"></i></button>
                  <button class="delete-btn">
                    <i class="fa fa-trash"></i>
                  </button>
                </td>
              </tr>
              <tr>
                <td>Dr. Adams</td>
                <td>Radiology</td>
                <td>adams@email.com</td>
                <td>+987654321</td>
                <td>
                  <button class="edit-btn"><i class="fa fa-edit"></i></button>
                  <button class="delete-btn">
                    <i class="fa fa-trash"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
          <!-- Doctor Modal -->
          <div id="doctor-modal" class="modal" style="display: none">
            <div class="modal-content">
              <span class="close-modal" id="close-doctor-modal">&times;</span>
              <h3 id="doctor-modal-title">Add Doctor</h3>
              <form id="doctor-form" enctype="multipart/form-data">
                <div class="form-group">
                  <label for="doctor-name">Name</label>
                  <input type="text" id="doctor-name" name="name" required />
                </div>
                <div class="form-group">
                  <label for="doctor-specialty">Specialty</label>
                  <input
                    type="text"
                    id="doctor-specialty"
                    name="specialty"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="doctor-email">Email</label>
                  <input type="email" id="doctor-email" name="email" required />
                </div>
                <div class="form-group">
                  <label for="doctor-phone">Phone</label>
                  <input type="text" id="doctor-phone" name="phone" required />
                </div>
                <div class="form-group">
                  <label for="doctor-bio">About</label>
                  <textarea
                    id="doctor-bio"
                    name="bio"
                    rows="3"
                    placeholder="Write about the doctor..."
                  ></textarea>
                </div>
                <div class="form-group">
                  <label for="doctor-image">Image</label>
                  <input
                    type="file"
                    id="doctor-image"
                    name="image"
                    accept="image/*"
                  />
                  <img
                    id="doctor-image-preview"
                    src=""
                    alt="Preview"
                    style="display: none; max-width: 120px; margin-top: 0.5rem"
                  />
                </div>
                <input type="hidden" id="doctor-id" name="id" />
                <button type="submit" class="save-btn">Save</button>
                <div
                  id="doctor-form-error"
                  style="color: #d32f2f; display: none; margin-top: 0.7rem"
                ></div>
                <div
                  id="doctor-form-success"
                  style="color: #388e3c; display: none; margin-top: 0.7rem"
                >
                  Doctor saved successfully!
                </div>
              </form>
            </div>
          </div>
        </section>
        <!-- Patients Section -->
        <section
          id="patients-section"
          class="dashboard-section-content"
          style="display: none"
        >
          <h2>Patients Management</h2>
          <button class="add-btn" id="add-patient-btn">
            <i class="fa fa-plus"></i> Add Patient
          </button>
          <table class="recent-table" id="patients-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Gender</th>
                <th>Age</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="patients-tbody">
              <tr>
                <td>John Doe</td>
                <td>Male</td>
                <td>34</td>
                <td>john@email.com</td>
                <td>+123456789</td>
                <td>
                  <button class="edit-btn"><i class="fa fa-edit"></i></button>
                  <button class="delete-btn">
                    <i class="fa fa-trash"></i>
                  </button>
                </td>
              </tr>
              <tr>
                <td>Jane Smith</td>
                <td>Female</td>
                <td>28</td>
                <td>jane@email.com</td>
                <td>+987654321</td>
                <td>
                  <button class="edit-btn"><i class="fa fa-edit"></i></button>
                  <button class="delete-btn">
                    <i class="fa fa-trash"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
          <!-- Patient Modal -->
          <div id="patient-modal" class="modal" style="display: none">
            <div class="modal-content">
              <span class="close-modal" id="close-patient-modal">&times;</span>
              <h3 id="patient-modal-title">Add Patient</h3>
              <form id="patient-form">
                <div class="form-group">
                  <label for="patient-name">Name</label>
                  <input type="text" id="patient-name" name="name" required />
                </div>
                <div class="form-group">
                  <label for="patient-gender">Gender</label>
                  <select id="patient-gender" name="gender" required>
                    <option value="">Select</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="patient-age">Age</label>
                  <input
                    type="number"
                    id="patient-age"
                    name="age"
                    required
                    min="0"
                  />
                </div>
                <div class="form-group">
                  <label for="patient-email">Email</label>
                  <input
                    type="email"
                    id="patient-email"
                    name="email"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="patient-phone">Phone</label>
                  <input type="text" id="patient-phone" name="phone" required />
                </div>
                <button type="submit" class="save-btn">Save</button>
                <div
                  id="patient-form-error"
                  style="color: #d32f2f; display: none; margin-top: 0.7rem"
                ></div>
                <div
                  id="patient-form-success"
                  style="color: #388e3c; display: none; margin-top: 0.7rem"
                >
                  Patient added successfully!
                </div>
              </form>
            </div>
          </div>
        </section>
        <!-- Appointments Section -->
        <section
          id="appointments-section"
          class="dashboard-section-content"
          style="display: none"
        >
          <h2>Appointments Management</h2>
          <div
            style="
              display: flex;
              gap: 1rem;
              align-items: center;
              margin-bottom: 1rem;
              flex-wrap: wrap;
            "
          >
            <label
              >Doctor:
              <select id="filter-appointment-doctor">
                <option value="">All</option>
                <option value="Dr. Smith">Dr. Smith</option>
                <option value="Dr. Adams">Dr. Adams</option>
                <option value="Dr. Brown">Dr. Brown</option>
                <option value="Dr. Patel">Dr. Patel</option>
              </select>
            </label>
            <label
              >Status:
              <select id="filter-appointment-status">
                <option value="">All</option>
                <option value="Completed">Completed</option>
                <option value="Pending">Pending</option>
                <option value="Cancelled">Cancelled</option>
              </select>
            </label>
            <button class="add-btn" id="add-appointment-btn">
              <i class="fa fa-plus"></i> Add Appointment
            </button>
          </div>
          <table class="recent-table" id="appointments-table">
            <thead>
              <tr>
                <th>Patient</th>
                <th>Doctor</th>
                <th>Date</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="appointments-tbody">
              <tr>
                <td>John Doe</td>
                <td>Dr. Smith</td>
                <td>2025-05-25</td>
                <td><span class="status completed">Completed</span></td>
                <td>
                  <button class="edit-btn"><i class="fa fa-edit"></i></button>
                  <button class="delete-btn">
                    <i class="fa fa-trash"></i>
                  </button>
                  <button class="prescription-btn">
                    <i class="fa fa-prescription"></i> Prescription
                  </button>
                </td>
              </tr>
              <tr>
                <td>Jane Smith</td>
                <td>Dr. Adams</td>
                <td>2025-05-26</td>
                <td><span class="status pending">Pending</span></td>
                <td>
                  <button class="edit-btn"><i class="fa fa-edit"></i></button>
                  <button class="delete-btn">
                    <i class="fa fa-trash"></i>
                  </button>
                  <button class="prescription-btn">
                    <i class="fa fa-prescription"></i> Prescription
                  </button>
                </td>
              </tr>
              <tr>
                <td>Michael Lee</td>
                <td>Dr. Brown</td>
                <td>2025-05-26</td>
                <td><span class="status cancelled">Cancelled</span></td>
                <td>
                  <button class="edit-btn"><i class="fa fa-edit"></i></button>
                  <button class="delete-btn">
                    <i class="fa fa-trash"></i>
                  </button>
                  <button class="prescription-btn">
                    <i class="fa fa-prescription"></i> Prescription
                  </button>
                </td>
              </tr>
              <tr>
                <td>Sarah Kim</td>
                <td>Dr. Patel</td>
                <td>2025-05-27</td>
                <td><span class="status pending">Pending</span></td>
                <td>
                  <button class="edit-btn"><i class="fa fa-edit"></i></button>
                  <button class="delete-btn">
                    <i class="fa fa-trash"></i>
                  </button>
                  <button class="prescription-btn">
                    <i class="fa fa-prescription"></i> Prescription
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
          <!-- Prescription Modal -->
          <div id="prescription-modal" class="modal" style="display: none">
            <div class="modal-content" style="max-width: 420px">
              <span class="close-modal" id="close-prescription-modal"
                >&times;</span
              >
              <h3>Create/View Prescription</h3>
              <form id="prescription-form">
                <div class="form-group">
                  <label for="prescription-notes">Prescription Notes</label>
                  <textarea
                    id="prescription-notes"
                    rows="3"
                    style="
                      width: 100%;
                      border-radius: 0.7rem;
                      border: 1px solid #b3c6e0;
                      padding: 0.5rem;
                    "
                  ></textarea>
                </div>
                <div class="form-group">
                  <label for="prescription-file">Attach File (PDF/Image)</label>
                  <input
                    type="file"
                    id="prescription-file"
                    accept=".pdf,image/*"
                  />
                </div>
                <button type="submit" class="save-btn" style="margin-top: 1rem">
                  <i class="fa fa-save"></i> Save Prescription
                </button>
              </form>
              <div style="margin-top: 1.5rem">
                <h4>Previous Prescriptions</h4>
                <ul
                  id="previous-prescriptions"
                  style="list-style: none; padding: 0"
                >
                  <li>No previous prescriptions.</li>
                </ul>
              </div>
            </div>
          </div>
        </section>
        <!-- Services Section -->
        <section
          id="services-section"
          class="dashboard-section-content"
          style="display: none"
        >
          <h2>Services Management</h2>
          <button class="add-btn" id="add-service-btn">
            <i class="fa fa-plus"></i> Add Service
          </button>
          <table class="recent-table" id="services-table">
            <thead>
              <tr>
                <th>Service Name</th>
                <th>Department</th>
                <th>Description</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="services-tbody">
              <tr>
                <td>Cardiology</td>
                <td>Heart</td>
                <td>Heart-related treatments</td>
                <td>
                  <button class="edit-btn"><i class="fa fa-edit"></i></button>
                  <button class="delete-btn">
                    <i class="fa fa-trash"></i>
                  </button>
                </td>
              </tr>
              <tr>
                <td>Radiology</td>
                <td>Imaging</td>
                <td>X-ray, MRI, CT scan</td>
                <td>
                  <button class="edit-btn"><i class="fa fa-edit"></i></button>
                  <button class="delete-btn">
                    <i class="fa fa-trash"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
          <!-- Service Modal -->
          <div id="service-modal" class="modal" style="display: none">
            <div class="modal-content">
              <span class="close-modal" id="close-service-modal">&times;</span>
              <h3 id="service-modal-title">Add Service</h3>
              <form id="service-form">
                <input type="hidden" id="service-index" />
                <label
                  >Service Name:<input type="text" id="service-name" required
                /></label>
                <label
                  >Department:<input
                    type="text"
                    id="service-department"
                    required
                /></label>
                <label
                  >Description:<input
                    type="text"
                    id="service-description"
                    required
                /></label>
                <button type="submit" class="save-btn">
                  <i class="fa fa-save"></i> Save
                </button>
              </form>
            </div>
          </div>
        </section>
        <!-- Lab Reports Section -->
        <section
          id="labreports-section"
          class="dashboard-section-content"
          style="display: none"
        >
          <h2>Lab Reports Management</h2>
          <button class="add-btn" id="add-lab-btn">
            <i class="fa fa-plus"></i> Add Lab Report
          </button>
          <table class="recent-table" id="labreports-table">
            <thead>
              <tr>
                <th>Patient</th>
                <th>Test</th>
                <th>Date</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="labreports-tbody">
              <tr>
                <td>John Doe</td>
                <td>Blood Test</td>
                <td>2025-05-25</td>
                <td><span class="status completed">Completed</span></td>
                <td>
                  <button class="edit-btn"><i class="fa fa-edit"></i></button>
                  <button class="delete-btn">
                    <i class="fa fa-trash"></i>
                  </button>
                </td>
              </tr>
              <tr>
                <td>Jane Smith</td>
                <td>X-Ray</td>
                <td>2025-05-26</td>
                <td><span class="status pending">Pending</span></td>
                <td>
                  <button class="edit-btn"><i class="fa fa-edit"></i></button>
                  <button class="delete-btn">
                    <i class="fa fa-trash"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
          <!-- Lab Modal -->
          <div id="lab-modal" class="modal" style="display: none">
            <div class="modal-content">
              <span class="close-modal" id="close-lab-modal">&times;</span>
              <h3 id="lab-modal-title">Add Lab Report</h3>
              <form id="lab-form">
                <input type="hidden" id="lab-index" />
                <label
                  >Patient:<input type="text" id="lab-patient" required
                /></label>
                <label>Test:<input type="text" id="lab-test" required /></label>
                <label>Date:<input type="date" id="lab-date" required /></label>
                <label
                  >Status:
                  <select id="lab-status" required>
                    <option value="Completed">Completed</option>
                    <option value="Pending">Pending</option>
                  </select>
                </label>
                <button type="submit" class="save-btn">
                  <i class="fa fa-save"></i> Save
                </button>
              </form>
            </div>
          </div>
        </section>
        <!-- Messages Section -->
        <section
          id="messages-section"
          class="dashboard-section-content"
          style="display: none"
        >
          <h2>Messages</h2>
          <button class="add-btn" id="add-message-btn">
            <i class="fa fa-plus"></i> Add Message
          </button>
          <table class="recent-table" id="messages-table">
            <thead>
              <tr>
                <th>From</th>
                <th>Email</th>
                <th>Subject</th>
                <th>Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="messages-tbody">
              <tr>
                <td>Mary Johnson</td>
                <td>maryj@email.com</td>
                <td>Appointment Inquiry</td>
                <td>2025-05-25</td>
                <td>
                  <button class="edit-btn"><i class="fa fa-edit"></i></button>
                  <button class="delete-btn">
                    <i class="fa fa-trash"></i>
                  </button>
                </td>
              </tr>
              <tr>
                <td>Paul Green</td>
                <td>paulg@email.com</td>
                <td>Lab Report</td>
                <td>2025-05-25</td>
                <td>
                  <button class="edit-btn"><i class="fa fa-edit"></i></button>
                  <button class="delete-btn">
                    <i class="fa fa-trash"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
          <!-- Message Modal -->
          <div id="message-modal" class="modal" style="display: none">
            <div class="modal-content">
              <span class="close-modal" id="close-message-modal">&times;</span>
              <h3 id="message-modal-title">Add Message</h3>
              <form id="message-form">
                <input type="hidden" id="message-index" />
                <label
                  >From:<input type="text" id="message-from" required
                /></label>
                <label
                  >Email:<input type="email" id="message-email" required
                /></label>
                <label
                  >Subject:<input type="text" id="message-subject" required
                /></label>
                <label
                  >Date:<input type="date" id="message-date" required
                /></label>
                <button type="submit" class="save-btn">
                  <i class="fa fa-save"></i> Save
                </button>
              </form>
            </div>
          </div>
          <!-- Message View Modal -->
          <div id="message-view-modal" class="modal" style="display: none">
            <div class="modal-content">
              <span class="close-modal" id="close-message-view-modal"
                >&times;</span
              >
              <h3>Message Details</h3>
              <div id="message-view-content"></div>
            </div>
          </div>
        </section>
        <!-- Settings Section -->
        <section
          id="settings-section"
          class="dashboard-section-content"
          style="display: none"
        >
          <h2>Settings</h2>
          <form class="settings-form">
            <label
              >Admin Email:
              <input type="email" value="admin@lekeakaakematu.com" />
            </label>
            <label
              >Change Password:
              <input type="password" placeholder="New Password" />
            </label>
            <button type="submit" class="save-btn">
              <i class="fa fa-save"></i> Save Changes
            </button>
          </form>
        </section>
      </main>
    </div>
    <script>
      // Set current date in sidebar
      document.getElementById("current-date").textContent =
        new Date().toLocaleDateString();
      // Section switching logic
      const sectionMap = {
        "dashboard-section": "dashboard-section",
        "doctors-section": "doctors-section",
        "patients-section": "patients-section",
        "appointments-section": "appointments-section",
        "services-section": "services-section",
        "labreports-section": "labreports-section",
        "messages-section": "messages-section",
        "settings-section": "settings-section",
      };
      const navLinks = document.querySelectorAll(".sidebar-menu a");
      function showSection(sectionId) {
        Object.values(sectionMap).forEach((id) => {
          const sec = document.getElementById(id);
          if (sec) sec.style.display = "none";
        });
        const activeSection = document.getElementById(sectionId);
        if (activeSection) activeSection.style.display = "";
        if (sectionId === "doctors-section") renderDoctors();
        if (sectionId === "patients-section") renderPatients();
        if (sectionId === "appointments-section") renderAppointments();
        if (sectionId === "services-section") renderServices();
        if (sectionId === "labreports-section") renderLabReports();
        if (sectionId === "messages-section") renderMessages();
      }
      navLinks.forEach((link) => {
        link.addEventListener("click", function (e) {
          e.preventDefault();
          navLinks.forEach((l) => l.classList.remove("active"));
          this.classList.add("active");
          let text = this.textContent.trim().toLowerCase();
          let sectionId = "dashboard-section";
          if (text.includes("doctor")) sectionId = "doctors-section";
          else if (text.includes("patient")) sectionId = "patients-section";
          else if (text.includes("appointment"))
            sectionId = "appointments-section";
          else if (text.includes("service")) sectionId = "services-section";
          else if (text.includes("lab")) sectionId = "labreports-section";
          else if (text.includes("message")) sectionId = "messages-section";
          else if (text.includes("setting")) sectionId = "settings-section";
          showSection(sectionId);
        });
      });
      // Show dashboard by default
      showSection("dashboard-section");
      // Doctors CRUD logic
      const doctorsTbody = document.getElementById("doctors-tbody");
      const addDoctorBtn = document.getElementById("add-doctor-btn");
      const doctorModal = document.getElementById("doctor-modal");
      const closeDoctorModal = document.getElementById("close-doctor-modal");
      const doctorForm = document.getElementById("doctor-form");
      const doctorModalTitle = document.getElementById("doctor-modal-title");
      const doctorIndexInput = document.getElementById("doctor-index");
      const doctorNameInput = document.getElementById("doctor-name");
      const doctorSpecialtyInput = document.getElementById("doctor-specialty");
      const doctorEmailInput = document.getElementById("doctor-email");
      const doctorPhoneInput = document.getElementById("doctor-phone");
      const doctorBioInput = document.getElementById("doctor-bio");
      const doctorImageInput = document.getElementById("doctor-image");
      const doctorImagePreview = document.getElementById(
        "doctor-image-preview"
      );
      let doctorsData = [
        {
          name: "Dr. Smith",
          specialty: "Cardiology",
          email: "smith@email.com",
          phone: "+123456789",
        },
        {
          name: "Dr. Adams",
          specialty: "Radiology",
          email: "adams@email.com",
          phone: "+987654321",
        },
      ];
      function renderDoctors() {
        doctorsTbody.innerHTML = "";
        doctorsData.forEach((doc, idx) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${doc.name}</td>
            <td>${doc.specialty}</td>
            <td>${doc.email}</td>
            <td>${doc.phone}</td>
            <td>
              <button class="edit-btn" data-idx="${idx}"><i class="fa fa-edit"></i></button>
              <button class="delete-btn" data-idx="${idx}"><i class="fa fa-trash"></i></button>
            </td>
          `;
          doctorsTbody.appendChild(tr);
        });
      }
      function openDoctorModal(editIdx = null) {
        doctorModal.style.display = "block";
        if (editIdx !== null) {
          doctorModalTitle.textContent = "Edit Doctor";
          doctorIndexInput.value = editIdx;
          doctorNameInput.value = doctorsData[editIdx].name;
          doctorSpecialtyInput.value = doctorsData[editIdx].specialty;
          doctorEmailInput.value = doctorsData[editIdx].email;
          doctorPhoneInput.value = doctorsData[editIdx].phone;
          doctorBioInput.value = doctorsData[editIdx].bio || "";
          doctorImagePreview.src = doctorsData[editIdx].image || "";
          doctorImagePreview.style.display = doctorImagePreview.src
            ? "block"
            : "none";
        } else {
          doctorModalTitle.textContent = "Add Doctor";
          doctorIndexInput.value = "";
          doctorForm.reset();
          doctorImagePreview.src = "";
          doctorImagePreview.style.display = "none";
        }
      }
      function closeDoctorModalFunc() {
        doctorModal.style.display = "none";
        doctorForm.reset();
      }
      addDoctorBtn.addEventListener("click", () => openDoctorModal());
      closeDoctorModal.addEventListener("click", closeDoctorModalFunc);
      doctorForm.addEventListener("submit", function (e) {
        e.preventDefault();
        const idx = doctorIndexInput.value;
        const newDoc = {
          name: doctorNameInput.value,
          specialty: doctorSpecialtyInput.value,
          email: doctorEmailInput.value,
          phone: doctorPhoneInput.value,
          bio: doctorBioInput.value,
          image: doctorImageInput.files[0],
        };
        const formData = new FormData();
        for (let key in newDoc) {
          formData.append(key, newDoc[key]);
        }
        if (idx === "") {
          fetch("http://localhost:5000/api/doctors", {
            method: "POST",
            body: formData,
          })
            .then((res) => {
              if (!res.ok) throw new Error("Failed to add doctor");
              return res.json();
            })
            .then(() => {
              renderDoctors();
              closeDoctorModalFunc();
              updateDashboardStats();
            })
            .catch((err) => {
              console.error(err);
              alert("Error: " + err.message);
            });
        } else {
          fetch(`http://localhost:5000/api/doctors/${idx}`, {
            method: "PUT",
            body: formData,
          })
            .then((res) => {
              if (!res.ok) throw new Error("Failed to update doctor");
              return res.json();
            })
            .then(() => {
              renderDoctors();
              closeDoctorModalFunc();
              updateDashboardStats();
            })
            .catch((err) => {
              console.error(err);
              alert("Error: " + err.message);
            });
        }
      });
      doctorsTbody.addEventListener("click", function (e) {
        if (e.target.closest(".edit-btn")) {
          const idx = e.target.closest(".edit-btn").dataset.idx;
          openDoctorModal(idx);
        } else if (e.target.closest(".delete-btn")) {
          const idx = e.target.closest(".delete-btn").dataset.idx;
          if (confirm("Are you sure you want to delete this doctor?")) {
            doctorsData.splice(idx, 1);
            renderDoctors();
          }
        }
      });
      // Modal close on outside click
      window.addEventListener("mousedown", function (e) {
        if (
          doctorModal.style.display === "block" &&
          !doctorModal.querySelector(".modal-content").contains(e.target) &&
          e.target !== addDoctorBtn
        ) {
          closeDoctorModalFunc();
        }
      });
      // Patients CRUD logic
      const patientsTbody = document.getElementById("patients-tbody");
      const addPatientBtn = document.getElementById("add-patient-btn");
      const patientModal = document.getElementById("patient-modal");
      const closePatientModal = document.getElementById("close-patient-modal");
      const patientForm = document.getElementById("patient-form");
      const patientModalTitle = document.getElementById("patient-modal-title");
      const patientIndexInput = document.getElementById("patient-index");
      const patientNameInput = document.getElementById("patient-name");
      const patientGenderInput = document.getElementById("patient-gender");
      const patientAgeInput = document.getElementById("patient-age");
      const patientEmailInput = document.getElementById("patient-email");
      const patientPhoneInput = document.getElementById("patient-phone");
      let patientsData = [
        {
          name: "John Doe",
          gender: "Male",
          age: 34,
          email: "john@email.com",
          phone: "+123456789",
        },
        {
          name: "Jane Smith",
          gender: "Female",
          age: 28,
          email: "jane@email.com",
          phone: "+987654321",
        },
      ];
      function renderPatients() {
        patientsTbody.innerHTML = "";
        patientsData.forEach((pat, idx) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${pat.name}</td>
            <td>${pat.gender}</td>
            <td>${pat.age}</td>
            <td>${pat.email}</td>
            <td>${pat.phone}</td>
            <td>
              <button class="edit-btn" data-idx="${idx}"><i class="fa fa-edit"></i></button>
              <button class="delete-btn" data-idx="${idx}"><i class="fa fa-trash"></i></button>
            </td>
          `;
          patientsTbody.appendChild(tr);
        });
      }
      function openPatientModal(editIdx = null) {
        patientModal.style.display = "block";
        if (editIdx !== null) {
          patientModalTitle.textContent = "Edit Patient";
          patientIndexInput.value = editIdx;
          patientNameInput.value = patientsData[editIdx].name;
          patientGenderInput.value = patientsData[editIdx].gender;
          patientAgeInput.value = patientsData[editIdx].age;
          patientEmailInput.value = patientsData[editIdx].email;
          patientPhoneInput.value = patientsData[editIdx].phone;
        } else {
          patientModalTitle.textContent = "Add Patient";
          patientIndexInput.value = "";
          patientForm.reset();
        }
      }
      function closePatientModalFunc() {
        patientModal.style.display = "none";
        patientForm.reset();
      }
      addPatientBtn.addEventListener("click", () => openPatientModal());
      closePatientModal.addEventListener("click", closePatientModalFunc);
      patientForm.addEventListener("submit", function (e) {
        e.preventDefault();
        const idx = patientIndexInput.value;
        const newPat = {
          name: patientNameInput.value,
          gender: patientGenderInput.value,
          age: patientAgeInput.value,
          email: patientEmailInput.value,
          phone: patientPhoneInput.value,
        };
        if (idx === "") {
          patientsData.push(newPat);
        } else {
          patientsData[idx] = newPat;
        }
        renderPatients();
        closePatientModalFunc();
      });
      patientsTbody.addEventListener("click", function (e) {
        if (e.target.closest(".edit-btn")) {
          const idx = e.target.closest(".edit-btn").dataset.idx;
          openPatientModal(idx);
        } else if (e.target.closest(".delete-btn")) {
          const idx = e.target.closest(".delete-btn").dataset.idx;
          if (confirm("Are you sure you want to delete this patient?")) {
            patientsData.splice(idx, 1);
            renderPatients();
          }
        }
      });
      // Modal close on outside click for patient
      window.addEventListener("mousedown", function (e) {
        if (
          patientModal.style.display === "block" &&
          !patientModal.querySelector(".modal-content").contains(e.target) &&
          e.target !== addPatientBtn
        ) {
          closePatientModalFunc();
        }
      });
      // Appointments CRUD logic
      const appointmentsTbody = document.querySelector(
        "#appointments-section tbody"
      );
      const addAppointmentBtn = document.querySelector(
        "#appointments-section .add-btn"
      );
      let appointmentModal = null,
        closeAppointmentModal = null,
        appointmentForm = null,
        appointmentModalTitle = null,
        appointmentIndexInput = null;
      let appointmentPatientInput = null,
        appointmentDoctorInput = null,
        appointmentDateInput = null,
        appointmentStatusInput = null;

      // Load appointments from localStorage (user bookings)
      function getLocalAppointments() {
        try {
          return JSON.parse(localStorage.getItem("appointmentsData")) || [];
        } catch {
          return [];
        }
      }

      // Modal HTML for Appointments
      function ensureAppointmentModal() {
        if (document.getElementById("appointment-modal")) return;
        const modal = document.createElement("div");
        modal.id = "appointment-modal";
        modal.className = "modal";
        modal.style.display = "none";
        modal.innerHTML = `
          <div class="modal-content">
            <span class="close-modal" id="close-appointment-modal">&times;</span>
            <h3 id="appointment-modal-title">Add Appointment</h3>
            <form id="appointment-form">
              <input type="hidden" id="appointment-index" />
              <label>Patient:<input type="text" id="appointment-patient" required /></label>
              <label>Doctor:<input type="text" id="appointment-doctor" required /></label>
              <label>Date:<input type="date" id="appointment-date" required /></label>
              <label>Status:
                <select id="appointment-status" required>
                  <option value="Completed">Completed</option>
                  <option value="Pending">Pending</option>
                  <option value="Cancelled">Cancelled</option>
                </select>
              </label>
              <button type="submit" class="save-btn"><i class="fa fa-save"></i> Save</button>
            </form>
          </div>
        `;
        document.querySelector("#appointments-section").appendChild(modal);
      }

      // --- Fetch and Render Appointments from Backend ---
      async function fetchAppointmentsFromBackend() {
        try {
          const res = await fetch("http://localhost:5000/api/appointments");
          if (!res.ok) throw new Error("Failed to fetch");
          const data = await res.json();
          return data;
        } catch {
          return [];
        }
      }
      async function renderAppointments() {
        const allApps = await fetchAppointmentsFromBackend();
        appointmentsTbody.innerHTML = "";
        allApps.forEach((app, idx) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${app.patientName || app.patient}</td>
            <td>${app.doctorName || app.doctor}</td>
            <td>${app.date} ${app.time ? app.time : ""}</td>
            <td><span class="status ${
              app.status ? app.status.toLowerCase() : "pending"
            }">${app.status || "Pending"}</span></td>
            <td>
              <button class="edit-btn" data-idx="${idx}"><i class="fa fa-edit"></i></button>
              <button class="delete-btn" data-idx="${idx}"><i class="fa fa-trash"></i></button>
            </td>
          `;
          appointmentsTbody.appendChild(tr);
        });
      }
      // On page load, fetch and render appointments
      renderAppointments();
      function openAppointmentModal(editIdx = null) {
        ensureAppointmentModal();
        appointmentModal = document.getElementById("appointment-modal");
        closeAppointmentModal = document.getElementById(
          "close-appointment-modal"
        );
        appointmentForm = document.getElementById("appointment-form");
        appointmentModalTitle = document.getElementById(
          "appointment-modal-title"
        );
        appointmentIndexInput = document.getElementById("appointment-index");
        appointmentPatientInput = document.getElementById(
          "appointment-patient"
        );
        appointmentDoctorInput = document.getElementById("appointment-doctor");
        appointmentDateInput = document.getElementById("appointment-date");
        appointmentStatusInput = document.getElementById("appointment-status");
        appointmentModal.style.display = "block";
        if (editIdx !== null) {
          appointmentModalTitle.textContent = "Edit Appointment";
          appointmentIndexInput.value = editIdx;
          appointmentPatientInput.value = appointmentsData[editIdx].patient;
          appointmentDoctorInput.value = appointmentsData[editIdx].doctor;
          appointmentDateInput.value = appointmentsData[editIdx].date;
          appointmentStatusInput.value = appointmentsData[editIdx].status;
        } else {
          appointmentModalTitle.textContent = "Add Appointment";
          appointmentIndexInput.value = "";
          appointmentForm.reset();
        }
      }
      function closeAppointmentModalFunc() {
        appointmentModal.style.display = "none";
        appointmentForm.reset();
      }
      if (addAppointmentBtn)
        addAppointmentBtn.addEventListener("click", () =>
          openAppointmentModal()
        );
      document.addEventListener("click", function (e) {
        if (e.target && e.target.id === "close-appointment-modal")
          closeAppointmentModalFunc();
      });
      document.addEventListener("submit", function (e) {
        if (e.target && e.target.id === "appointment-form") {
          e.preventDefault();
          const idx = appointmentIndexInput.value;
          const newApp = {
            patient: appointmentPatientInput.value,
            doctor: appointmentDoctorInput.value,
            date: appointmentDateInput.value,
            status: appointmentStatusInput.value,
          };
          if (idx === "") appointmentsData.push(newApp);
          else appointmentsData[idx] = newApp;
          renderAppointments();
          closeAppointmentModalFunc();
        }
      });
      appointmentsTbody.addEventListener("click", function (e) {
        if (e.target.closest(".edit-btn")) {
          const idx = e.target.closest(".edit-btn").dataset.idx;
          openAppointmentModal(idx);
        } else if (e.target.closest(".delete-btn")) {
          const idx = e.target.closest(".delete-btn").dataset.idx;
          if (confirm("Are you sure you want to delete this appointment?")) {
            appointmentsData.splice(idx, 1);
            renderAppointments();
          }
        }
      });
      window.addEventListener("mousedown", function (e) {
        ensureAppointmentModal();
        if (
          appointmentModal &&
          appointmentModal.style.display === "block" &&
          !appointmentModal
            .querySelector(".modal-content")
            .contains(e.target) &&
          e.target !== addAppointmentBtn
        ) {
          closeAppointmentModalFunc();
        }
      });
      // Services CRUD logic
      const servicesTbody = document.querySelector("#services-section tbody");
      const addServiceBtn = document.querySelector(
        "#services-section .add-btn"
      );
      let serviceModal = null,
        closeServiceModal = null,
        serviceForm = null,
        serviceModalTitle = null,
        serviceIndexInput = null;
      let serviceNameInput = null,
        serviceDeptInput = null,
        serviceDescInput = null;
      function ensureServiceModal() {
        if (document.getElementById("service-modal")) return;
        const modal = document.createElement("div");
        modal.id = "service-modal";
        modal.className = "modal";
        modal.style.display = "none";
        modal.innerHTML = `
          <div class="modal-content">
            <span class="close-modal" id="close-service-modal">&times;</span>
            <h3 id="service-modal-title">Add Service</h3>
            <form id="service-form">
              <input type="hidden" id="service-index" />
              <label>Service Name:<input type="text" id="service-name" required /></label>
              <label>Department:<input type="text" id="service-dept" required /></label>
              <label>Description:<input type="text" id="service-desc" required /></label>
              <button type="submit" class="save-btn"><i class="fa fa-save"></i> Save</button>
            </form>
          </div>
        `;
        document.querySelector("#services-section").appendChild(modal);
      }
      let servicesData = [
        { name: "Cardiology", dept: "Heart", desc: "Heart-related treatments" },
        { name: "Radiology", dept: "Imaging", desc: "X-ray, MRI, CT scan" },
      ];
      function renderServices() {
        servicesTbody.innerHTML = "";
        servicesData.forEach((srv, idx) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${srv.name}</td>
            <td>${srv.dept}</td>
            <td>${srv.desc}</td>
            <td>
              <button class="edit-btn" data-idx="${idx}"><i class="fa fa-edit"></i></button>
              <button class="delete-btn" data-idx="${idx}"><i class="fa fa-trash"></i></button>
            </td>
          `;
          servicesTbody.appendChild(tr);
        });
      }
      function openServiceModal(editIdx = null) {
        ensureServiceModal();
        serviceModal = document.getElementById("service-modal");
        closeServiceModal = document.getElementById("close-service-modal");
        serviceForm = document.getElementById("service-form");
        serviceModalTitle = document.getElementById("service-modal-title");
        serviceIndexInput = document.getElementById("service-index");
        serviceNameInput = document.getElementById("service-name");
        serviceDeptInput = document.getElementById("service-dept");
        serviceDescInput = document.getElementById("service-desc");
        serviceModal.style.display = "block";
        if (editIdx !== null) {
          serviceModalTitle.textContent = "Edit Service";
          serviceIndexInput.value = editIdx;
          serviceNameInput.value = servicesData[editIdx].name;
          serviceDeptInput.value = servicesData[editIdx].dept;
          serviceDescInput.value = servicesData[editIdx].desc;
        } else {
          serviceModalTitle.textContent = "Add Service";
          serviceIndexInput.value = "";
          serviceForm.reset();
        }
      }
      function closeServiceModalFunc() {
        serviceModal.style.display = "none";
        serviceForm.reset();
      }
      if (addServiceBtn)
        addServiceBtn.addEventListener("click", () => openServiceModal());
      document.addEventListener("click", function (e) {
        if (e.target && e.target.id === "close-service-modal")
          closeServiceModalFunc();
      });
      document.addEventListener("submit", function (e) {
        if (e.target && e.target.id === "service-form") {
          e.preventDefault();
          const idx = serviceIndexInput.value;
          const newSrv = {
            name: serviceNameInput.value,
            dept: serviceDeptInput.value,
            desc: serviceDescInput.value,
          };
          if (idx === "") servicesData.push(newSrv);
          else servicesData[idx] = newSrv;
          renderServices();
          closeServiceModalFunc();
        }
      });
      servicesTbody.addEventListener("click", function (e) {
        if (e.target.closest(".edit-btn")) {
          const idx = e.target.closest(".edit-btn").dataset.idx;
          openServiceModal(idx);
        } else if (e.target.closest(".delete-btn")) {
          const idx = e.target.closest(".delete-btn").dataset.idx;
          if (confirm("Are you sure you want to delete this service?")) {
            servicesData.splice(idx, 1);
            renderServices();
          }
        }
      });
      window.addEventListener("mousedown", function (e) {
        ensureServiceModal();
        if (
          serviceModal &&
          serviceModal.style.display === "block" &&
          !serviceModal.querySelector(".modal-content").contains(e.target) &&
          e.target !== addServiceBtn
        ) {
          closeServiceModalFunc();
        }
      });
      // Lab Reports CRUD logic
      const labreportsTbody = document.querySelector(
        "#labreports-section tbody"
      );
      const addLabReportBtn = document.querySelector(
        "#labreports-section .add-btn"
      );
      let labreportModal = null,
        closeLabReportModal = null,
        labreportForm = null,
        labreportModalTitle = null,
        labreportIndexInput = null;
      let labreportPatientInput = null,
        labreportTestInput = null,
        labreportDateInput = null,
        labreportStatusInput = null;
      function ensureLabReportModal() {
        if (document.getElementById("labreport-modal")) return;
        const modal = document.createElement("div");
        modal.id = "labreport-modal";
        modal.className = "modal";
        modal.style.display = "none";
        modal.innerHTML = `
          <div class="modal-content">
            <span class="close-modal" id="close-labreport-modal">&times;</span>
            <h3 id="labreport-modal-title">Add Lab Report</h3>
            <form id="labreport-form">
              <input type="hidden" id="labreport-index" />
              <label>Patient:<input type="text" id="labreport-patient" required /></label>
              <label>Test:<input type="text" id="labreport-test" required /></label>
              <label>Date:<input type="date" id="labreport-date" required /></label>
              <label>Status:
                <select id="labreport-status" required>
                  <option value="Completed">Completed</option>
                  <option value="Pending">Pending</option>
                </select>
              </label>
              <button type="submit" class="save-btn"><i class="fa fa-save"></i> Save</button>
            </form>
          </div>
        `;
        document.querySelector("#labreports-section").appendChild(modal);
      }
      let labreportsData = [
        {
          patient: "John Doe",
          test: "Blood Test",
          date: "2025-05-25",
          status: "Completed",
        },
        {
          patient: "Jane Smith",
          test: "X-Ray",
          date: "2025-05-26",
          status: "Pending",
        },
      ];
      function renderLabReports() {
        labreportsTbody.innerHTML = "";
        labreportsData.forEach((lab, idx) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${lab.patient}</td>
            <td>${lab.test}</td>
            <td>${lab.date}</td>
            <td><span class="status ${lab.status.toLowerCase()}">${
            lab.status
          }</span></td>
            <td>
              <button class="edit-btn" data-idx="${idx}"><i class="fa fa-edit"></i></button>
              <button class="delete-btn" data-idx="${idx}"><i class="fa fa-trash"></i></button>
            </td>
          `;
          labreportsTbody.appendChild(tr);
        });
      }
      function openLabReportModal(editIdx = null) {
        ensureLabReportModal();
        labreportModal = document.getElementById("labreport-modal");
        closeLabReportModal = document.getElementById("close-labreport-modal");
        labreportForm = document.getElementById("labreport-form");
        labreportModalTitle = document.getElementById("labreport-modal-title");
        labreportIndexInput = document.getElementById("labreport-index");
        labreportPatientInput = document.getElementById("labreport-patient");
        labreportTestInput = document.getElementById("labreport-test");
        labreportDateInput = document.getElementById("labreport-date");
        labreportStatusInput = document.getElementById("labreport-status");
        labreportModal.style.display = "block";
        if (editIdx !== null) {
          labreportModalTitle.textContent = "Edit Lab Report";
          labreportIndexInput.value = editIdx;
          labreportPatientInput.value = labreportsData[editIdx].patient;
          labreportTestInput.value = labreportsData[editIdx].test;
          labreportDateInput.value = labreportsData[editIdx].date;
          labreportStatusInput.value = labreportsData[editIdx].status;
        } else {
          labreportModalTitle.textContent = "Add Lab Report";
          labreportIndexInput.value = "";
          labreportForm.reset();
        }
      }
      function closeLabReportModalFunc() {
        labreportModal.style.display = "none";
        labreportForm.reset();
      }
      if (addLabReportBtn)
        addLabReportBtn.addEventListener("click", () => openLabReportModal());
      document.addEventListener("click", function (e) {
        if (e.target && e.target.id === "close-labreport-modal")
          closeLabReportModalFunc();
      });
      document.addEventListener("submit", function (e) {
        if (e.target && e.target.id === "labreport-form") {
          e.preventDefault();
          const idx = labreportIndexInput.value;
          const newLab = {
            patient: labreportPatientInput.value,
            test: labreportTestInput.value,
            date: labreportDateInput.value,
            status: labreportStatusInput.value,
          };
          if (idx === "") labreportsData.push(newLab);
          else labreportsData[idx] = newLab;
          renderLabReports();
          closeLabReportModalFunc();
        }
      });
      labreportsTbody.addEventListener("click", function (e) {
        if (e.target.closest(".edit-btn")) {
          const idx = e.target.closest(".edit-btn").dataset.idx;
          openLabReportModal(idx);
        } else if (e.target.closest(".delete-btn")) {
          const idx = e.target.closest(".delete-btn").dataset.idx;
          if (confirm("Are you sure you want to delete this lab report?")) {
            labreportsData.splice(idx, 1);
            renderLabReports();
          }
        }
      });
      window.addEventListener("mousedown", function (e) {
        ensureLabReportModal();
        if (
          labreportModal &&
          labreportModal.style.display === "block" &&
          !labreportModal.querySelector(".modal-content").contains(e.target) &&
          e.target !== addLabReportBtn
        ) {
          closeLabReportModalFunc();
        }
      });
      // Messages CRUD logic
      const messagesTbody = document.querySelector("#messages-section tbody");
      let addMessageBtn = null; // No add button in UI, but logic is here for completeness
      let messageModal = null,
        closeMessageModal = null,
        messageForm = null,
        messageModalTitle = null,
        messageIndexInput = null;
      let messageFromInput = null,
        messageEmailInput = null,
        messageSubjectInput = null,
        messageDateInput = null;
      let messageViewModal = null,
        closeMessageViewModal = null,
        messageViewContent = null;
      function ensureMessageModal() {
        if (document.getElementById("message-modal")) return;
        const modal = document.createElement("div");
        modal.id = "message-modal";
        modal.className = "modal";
        modal.style.display = "none";
        modal.innerHTML = `
          <div class="modal-content">
            <span class="close-modal" id="close-message-modal">&times;</span>
            <h3 id="message-modal-title">Add Message</h3>
            <form id="message-form">
              <input type="hidden" id="message-index" />
              <label>From:<input type="text" id="message-from" required /></label>
              <label>Email:<input type="email" id="message-email" required /></label>
              <label>Subject:<input type="text" id="message-subject" required /></label>
              <label>Date:<input type="date" id="message-date" required /></label>
              <button type="submit" class="save-btn"><i class="fa fa-save"></i> Save</button>
            </form>
          </div>
        `;
        document.querySelector("#messages-section").appendChild(modal);
      }
      function ensureMessageViewModal() {
        if (document.getElementById("message-view-modal")) return;
        const modal = document.createElement("div");
        modal.id = "message-view-modal";
        modal.className = "modal";
        modal.style.display = "none";
        modal.innerHTML = `
          <div class="modal-content">
            <span class="close-modal" id="close-message-view-modal">&times;</span>
            <h3>Message Details</h3>
            <div id="message-view-content"></div>
          </div>
        `;
        document.querySelector("#messages-section").appendChild(modal);
      }
      let messagesData = [
        {
          from: "Mary Johnson",
          email: "maryj@email.com",
          subject: "Appointment Inquiry",
          date: "2025-05-25",
        },
        {
          from: "Paul Green",
          email: "paulg@email.com",
          subject: "Lab Report",
          date: "2025-05-25",
        },
      ];
      function renderMessages() {
        messagesTbody.innerHTML = "";
        messagesData.forEach((msg, idx) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${msg.from}</td>
            <td>${msg.email}</td>
            <td>${msg.subject}</td>
            <td>${msg.date}</td>
            <td>
              <button class="view-btn" data-idx="${idx}"><i class="fa fa-eye"></i></button>
              <button class="edit-btn" data-idx="${idx}"><i class="fa fa-edit"></i></button>
              <button class="delete-btn" data-idx="${idx}"><i class="fa fa-trash"></i></button>
            </td>
          `;
          messagesTbody.appendChild(tr);
        });
      }
      function openMessageModal(editIdx = null) {
        ensureMessageModal();
        messageModal = document.getElementById("message-modal");
        closeMessageModal = document.getElementById("close-message-modal");
        messageForm = document.getElementById("message-form");
        messageModalTitle = document.getElementById("message-modal-title");
        messageIndexInput = document.getElementById("message-index");
        messageFromInput = document.getElementById("message-from");
        messageEmailInput = document.getElementById("message-email");
        messageSubjectInput = document.getElementById("message-subject");
        messageDateInput = document.getElementById("message-date");
        messageModal.style.display = "block";
        if (editIdx !== null) {
          messageModalTitle.textContent = "Edit Message";
          messageIndexInput.value = editIdx;
          messageFromInput.value = messagesData[editIdx].from;
          messageEmailInput.value = messagesData[editIdx].email;
          messageSubjectInput.value = messagesData[editIdx].subject;
          messageDateInput.value = messagesData[editIdx].date;
        } else {
          messageModalTitle.textContent = "Add Message";
          messageIndexInput.value = "";
          messageForm.reset();
        }
      }
      function closeMessageModalFunc() {
        messageModal.style.display = "none";
        messageForm.reset();
      }
      function openMessageViewModal(idx) {
        ensureMessageViewModal();
        messageViewModal = document.getElementById("message-view-modal");
        closeMessageViewModal = document.getElementById(
          "close-message-view-modal"
        );
        messageViewContent = document.getElementById("message-view-content");
        const msg = messagesData[idx];
        messageViewContent.innerHTML = `<strong>From:</strong> ${msg.from}<br><strong>Email:</strong> ${msg.email}<br><strong>Subject:</strong> ${msg.subject}<br><strong>Date:</strong> ${msg.date}`;
        messageViewModal.style.display = "block";
      }
      function closeMessageViewModalFunc() {
        messageViewModal.style.display = "none";
        messageViewContent.innerHTML = "";
      }
      document.addEventListener("click", function (e) {
        if (e.target && e.target.id === "close-message-modal")
          closeMessageModalFunc();
        if (e.target && e.target.id === "close-message-view-modal")
          closeMessageViewModalFunc();
      });
      document.addEventListener("submit", function (e) {
        if (e.target && e.target.id === "message-form") {
          e.preventDefault();
          const idx = messageIndexInput.value;
          const newMsg = {
            from: messageFromInput.value,
            email: messageEmailInput.value,
            subject: messageSubjectInput.value,
            date: messageDateInput.value,
          };
          if (idx === "") messagesData.push(newMsg);
          else messagesData[idx] = newMsg;
          renderMessages();
          closeMessageModalFunc();
        }
      });
      messagesTbody.addEventListener("click", function (e) {
        if (e.target.closest(".view-btn")) {
          const idx = e.target.closest(".view-btn").dataset.idx;
          openMessageViewModal(idx);
        } else if (e.target.closest(".edit-btn")) {
          const idx = e.target.closest(".edit-btn").dataset.idx;
          openMessageModal(idx);
        } else if (e.target.closest(".delete-btn")) {
          const idx = e.target.closest(".delete-btn").dataset.idx;
          if (confirm("Are you sure you want to delete this message?")) {
            messagesData.splice(idx, 1);
            renderMessages();
          }
        }
      });
      window.addEventListener("mousedown", function (e) {
        ensureMessageModal();
        ensureMessageViewModal();
        if (
          messageModal &&
          messageModal.style.display === "block" &&
          !messageModal.querySelector(".modal-content").contains(e.target)
        ) {
          closeMessageModalFunc();
        }
        if (
          messageViewModal &&
          messageViewModal.style.display === "block" &&
          !messageViewModal.querySelector(".modal-content").contains(e.target)
        ) {
          closeMessageViewModalFunc();
        }
      });
      // --- Dashboard Stats: Fetch Counts from Backend ---
      async function fetchCount(url) {
        try {
          const res = await fetch(url);
          if (!res.ok) throw new Error("Failed");
          const data = await res.json();
          return Array.isArray(data) ? data.length : data.count || 0;
        } catch {
          return 0;
        }
      }
      async function updateDashboardStats() {
        const [doctorCount, patientCount, appointmentCount] = await Promise.all(
          [
            fetchCount("http://localhost:5000/api/doctors"),
            fetchCount("http://localhost:5000/api/patients/count"),
            fetchCount("http://localhost:5000/api/appointments"),
          ]
        );
        document.querySelectorAll(".stat-label").forEach((el) => {
          if (el.textContent.includes("Doctor"))
            el.nextElementSibling.textContent = doctorCount;
          if (el.textContent.includes("Patient"))
            el.nextElementSibling.textContent = patientCount;
          if (el.textContent.includes("Appointment"))
            el.nextElementSibling.textContent = appointmentCount;
        });
      }
      updateDashboardStats();

      async function fetchDoctors() {
        try {
          const res = await fetch("http://localhost:5000/api/doctors");
          if (!res.ok) throw new Error("Failed");
          return await res.json();
        } catch {
          return [];
        }
      }
      function doctorRowHTML(doc, idx) {
        return `<tr>
    <td>${doc.name}</td>
    <td>${doc.specialty}</td>
    <td>${doc.email || ""}</td>
    <td>${doc.phone || ""}</td>
    <td>
      <button class="edit-btn" data-idx="${idx}"><i class="fa fa-edit"></i></button>
      <button class="delete-btn" data-idx="${idx}"><i class="fa fa-trash"></i></button>
    </td>
  </tr>`;
      }
      async function renderDoctors() {
        const doctors = await fetchDoctors();
        const tbody = document.getElementById("doctors-tbody");
        tbody.innerHTML = doctors.map(doctorRowHTML).join("");
      }
      renderDoctors();
      // --- Add Doctor Modal Logic ---
      document.getElementById("add-doctor-btn").onclick = function () {
        document.getElementById("doctor-modal-title").textContent =
          "Add Doctor";
        document.getElementById("doctor-form").reset();
        document.getElementById("doctor-modal").style.display = "block";
      };
      document.getElementById("close-doctor-modal").onclick = function () {
        document.getElementById("doctor-modal").style.display = "none";
      };
      document.getElementById("doctor-form").onsubmit = async function (e) {
        e.preventDefault();
        const name = document.getElementById("doctor-name").value;
        const specialty = document.getElementById("doctor-specialty").value;
        const email = document.getElementById("doctor-email").value;
        const phone = document.getElementById("doctor-phone").value;
        const bio = document.getElementById("doctor-bio").value;
        const image = document.getElementById("doctor-image").files[0];
        const errorDiv = document.getElementById("doctor-form-error");
        const successDiv = document.getElementById("doctor-form-success");
        errorDiv.style.display = "none";
        successDiv.style.display = "none";
        try {
          const res = await fetch("http://localhost:5000/api/doctors", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, specialty, email, phone, bio }),
          });
          if (res.ok) {
            const data = await res.json();
            if (image) {
              const formData = new FormData();
              formData.append("image", image);
              await fetch(
                `http://localhost:5000/api/doctors/${data.id}/image`,
                {
                  method: "POST",
                  body: formData,
                }
              );
            }
            successDiv.style.display = "block";
            setTimeout(() => {
              document.getElementById("doctor-modal").style.display = "none";
              successDiv.style.display = "none";
              renderDoctors();
              updateDashboardStats();
            }, 1200);
          } else {
            const data = await res.json().catch(() => ({}));
            errorDiv.textContent = data.message || "Failed to add doctor.";
            errorDiv.style.display = "block";
          }
        } catch {
          errorDiv.textContent = "Server error.";
          errorDiv.style.display = "block";
        }
      };
      // --- Patients CRUD: Fetch, Add, Render ---
      async function fetchPatients() {
        try {
          const res = await fetch("http://localhost:5000/api/patients");
          if (!res.ok) throw new Error("Failed");
          return await res.json();
        } catch {
          return [];
        }
      }
      function patientRowHTML(pat, idx) {
        return `<tr>
    <td>${pat.name}</td>
    <td>${pat.gender}</td>
    <td>${pat.age}</td>
    <td>${pat.email}</td>
    <td>${pat.phone}</td>
    <td>
      <button class="edit-btn" data-idx="${idx}"><i class="fa fa-edit"></i></button>
      <button class="delete-btn" data-idx="${idx}"><i class="fa fa-trash"></i></button>
    </td>
  </tr>`;
      }
      async function renderPatients() {
        const patients = await fetchPatients();
        const tbody = document.getElementById("patients-tbody");
        tbody.innerHTML = patients.map(patientRowHTML).join("");
      }
      renderPatients();
      document.getElementById("add-patient-btn").onclick = function () {
        document.getElementById("patient-modal-title").textContent =
          "Add Patient";
        document.getElementById("patient-form").reset();
        document.getElementById("patient-modal").style.display = "block";
      };
      document.getElementById("close-patient-modal").onclick = function () {
        document.getElementById("patient-modal").style.display = "none";
      };
      document.getElementById("patient-form").onsubmit = async function (e) {
        e.preventDefault();
        const name = document.getElementById("patient-name").value;
        const gender = document.getElementById("patient-gender").value;
        const age = document.getElementById("patient-age").value;
        const email = document.getElementById("patient-email").value;
        const phone = document.getElementById("patient-phone").value;
        const errorDiv = document.getElementById("patient-form-error");
        const successDiv = document.getElementById("patient-form-success");
        errorDiv.style.display = "none";
        successDiv.style.display = "none";
        try {
          const res = await fetch("http://localhost:5000/api/patients", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, gender, age, email, phone }),
          });
          if (res.ok) {
            successDiv.style.display = "block";
            setTimeout(() => {
              document.getElementById("patient-modal").style.display = "none";
              successDiv.style.display = "none";
              renderPatients();
              updateDashboardStats && updateDashboardStats();
            }, 1200);
          } else {
            const data = await res.json().catch(() => ({}));
            errorDiv.textContent = data.message || "Failed to add patient.";
            errorDiv.style.display = "block";
          }
        } catch {
          errorDiv.textContent = "Server error.";
          errorDiv.style.display = "block";
        }
      };
    </script>
  </body>
</html>
